

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Step 1: Motion Correction &#8212; fMRI Image Preprocessing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2.motion';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Step 2: Slice-Timing" href="3.slice-timing.html" />
    <link rel="prev" title="The Structure of fMRI Data" href="1.fmri-structure.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="fMRI Image Preprocessing - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="fMRI Image Preprocessing - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.fmri-structure.html">The Structure of fMRI Data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Step 1: Motion Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.slice-timing.html">Step 2: Slice-Timing</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.normalisation.html">Step 3: Normalisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.smoothing.html">Step 4: Smoothing</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.building-pipelines.html">Building the Preprocessing Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.preprocessing-code.html">Running Preprocessing Using MATLAB Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="8.summary-quiz.html">Summary and Quiz</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/martynmcfarquhar/NCCN-IA-fMRIPreProcessing" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/martynmcfarquhar/NCCN-IA-fMRIPreProcessing/issues/new?title=Issue%20on%20page%20%2F2.motion.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2.motion.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Step 1: Motion Correction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-motion">Problems with motion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corruption-of-the-timeseries">Corruption of the timeseries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corruption-of-the-measurement-of-the-signal">Corruption of the measurement of the signal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correlated-with-the-task">Motion correlated with the task</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction-theory">Motion correction theory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-parameters">Motion parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resampling-the-fmri-data">Resampling the fMRI data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-much-motion-it-too-much">How much motion it too much?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction-in-spm">Motion correction in SPM</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="step-1-motion-correction">
<h1>Step 1: Motion Correction<a class="headerlink" href="#step-1-motion-correction" title="Permalink to this heading">#</a></h1>
<p>Typically, one of the biggest sources of variance in the fMRI timeseries is due to subjects moving in the scanner. Subject motion is inevitable, as it is very difficult to stay perfectly still for the 5-10 minute duration of a typical fMRI task. Unfortunately, in cases where motion is particularly bad it can cause such damage to the data that the scan cannot be used. Even in cases where the motion seems slight, changes in head position of as little as 2-3mm can corrupt the data. Motion is therefore a serious issue for the quality of individual scans, but is also a big problem for group comparisons. For instance, if you have one group with less tolerance for the scanning environment than the other, such as the elderly or young children. Because motion can cause spurious activations to appear, one group moving more than the other may cause spurious group differences that we misconstrue as true neuronal differences between the groups. As such, we always have to encourage our subjects to stay as still as possible. Eliminating motion at the source is really the best way to deal with this issue. However, we also need to recognise that there will always be some motion, and need be aware of what we can and cannot do to try and fix it.</p>
<section id="problems-with-motion">
<h2>Problems with motion<a class="headerlink" href="#problems-with-motion" title="Permalink to this heading">#</a></h2>
<p>There are two main issues that motion can cause. The first is that motion causes individual voxels to suddenly contain data from a different part of the brain. The second is that motion can disrupt that actual signal recording from the scanner. Both these issues can be further compounded by motion that occurs more during one specific conditions of a task compared to others. In this case, the motion is said to be correlated with the task, which can create a serious confound in the data.</p>
<section id="corruption-of-the-timeseries">
<h3>Corruption of the timeseries<a class="headerlink" href="#corruption-of-the-timeseries" title="Permalink to this heading">#</a></h3>
<p>The main issue with motion is that if the subject moves then suddenly our timeseries at an individual voxel is no longer a continuous measure of that point in the brain. Instead, the timeseries measures several points in the brain over time. Depending on the spatial extent of the activity, and how small the voxel size is, this may or may not make a big difference. However, this becomes more problematic at tissue boundaries. For instance, when motion causes a voxel to contain signal from inside and outside the head, or inside and outside the ventricles. In these cases, the sudden shift in tissue type will cause a sudden shift in signal intensity that may be appear as true brain activity when we analyse the data. This is shown in <a class="reference internal" href="#mot-spikes-fig"><span class="std std-numref">Fig. 4</span></a> where 20 volumes in the middle of a functional series have been artificially shifted by the width of a voxel to the left and then back again. A voxel on the edge of the ventricles has been highlighted. We can see how the time series is corrupted by the motion. This is such an extreme change in intensity that it could be easily mistaken for true brain activity.</p>
<figure class="align-default" id="mot-spikes-fig">
<a class="reference internal image-reference" href="_images/mot-spikes.png"><img alt="_images/mot-spikes.png" src="_images/mot-spikes.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Illustration of how sudden changes in signal intensity can occur after head motion.</span><a class="headerlink" href="#mot-spikes-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>One saving grace of this form of motion is that often we will see activation effects that sit along the border between tissue types. So any activation pattern that sits along the edge of the brain, or along the edge of the ventricles, should be treated with extreme caution. An example is shown in <a class="reference internal" href="#mot-edge-fig"><span class="std std-numref">Fig. 5</span></a>. That being said, we cannot rely on motion artifacts always being visible in our results, as motion can also cause more subtle corrupting effects on the data. As we will see below, there are means for correcting motion, but these are imperfect and have their limitations. In some cases the motion can be so bad that we simply cannot trust the data and thus have to just throw the scan away.</p>
<figure class="align-default" id="mot-edge-fig">
<a class="reference internal image-reference" href="_images/mot-edge.png"><img alt="_images/mot-edge.png" src="_images/mot-edge.png" style="width: 250px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Illustration of how motion artefacts can appear along the edges of the brain.</span><a class="headerlink" href="#mot-edge-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="corruption-of-the-measurement-of-the-signal">
<h3>Corruption of the measurement of the signal<a class="headerlink" href="#corruption-of-the-measurement-of-the-signal" title="Permalink to this heading">#</a></h3>
<p>A more insidious effect of motion is that it can impact the signal that is measured by the scanner. When the subject’s head moves, protons from a neighbouring slice with a different excitation move into the voxel. This disrupts the magnetic gradients and the subsequent reconstructed signal will not be accurate. This is exacerbated when using an inter-leaved acquisition sequence, as the excitation differences between neighbouring slices will be greater. The important point here is that this cannot be corrected by the standard motion correction techniques described below. Although so-called spin-history correction has been proposed (e.g. Friston et al, 1996), this is not in common use and any residual effects of motion after pre-processing are usually accommodated during the statistical modelling. However, the success of this approach remains somewhat unknown and so this issue remains one that is somewhat ignored during standard fMRI processing. In extreme cases, the spin-history effects will be easily visible as striping in the image, as shown in <a class="reference internal" href="#spin-hist-fig"><span class="std std-numref">Fig. 6</span></a>. The top row shows an interleaved sequence and the bottom row shows a sequential sequence. The left column is a scan without motion and the right is a scan with motion. So the lesson here is to make sure you check your data visually to see whether there are any extreme spin history effects. If there are, the scan may be unusable.</p>
<figure class="align-default" id="spin-hist-fig">
<a class="reference internal image-reference" href="_images/spin-history.gif"><img alt="_images/spin-history.gif" src="_images/spin-history.gif" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Spin history effects in both an interleaved (top) and sequential (bottom) sequence.</span><a class="headerlink" href="#spin-hist-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="motion-correlated-with-the-task">
<h3>Motion correlated with the task<a class="headerlink" href="#motion-correlated-with-the-task" title="Permalink to this heading">#</a></h3>
<p>The point where motion-based corruption of the timeseries becomes especially problematic is when it happens more in some conditions of the scanner task than others. For instance, consider a task with alternating easy and difficult conditions. It is plausible that frustration during the difficult condition may cause subjects to move more compared to the easy condition. If this happens, we will get movement-related intensity changes during the difficult condition that will be inseparable from intensity changes that related to true brain activity. At which point, we have no idea whether results for the difficult condition represent motion, true brain activity, or some messy combination of the two. To make matters worse, any attempt to remove the motion effects will also remove true brain activity, because there is no way to separate them. At this point, motion becomes an inescapable confound and you cannot reach any conclusions about the data. There are ways to check for the correlation between the task and motion, but if this correlation if high then there is nothing that can be done to correct for it and the data become fundamentally unreliable.</p>
</section>
</section>
<section id="motion-correction-theory">
<h2>Motion correction theory<a class="headerlink" href="#motion-correction-theory" title="Permalink to this heading">#</a></h2>
<p>Now we know the problems caused by motion, what can we do about it? Typically we perform spatial motion correction as a first pre-processing step, to move all the volumes back into alignment with one another. In principle, this will alleviate the issues of the timeseries being corrupted, but of course will not fix spin-history effects nor issues of task-correlated motion. So it is not a complete solution to motion, but will help with some of the more common issues. In SPM, this form of motion correction is known as realignment and is illustrated in <a class="reference internal" href="#realign-poldrack-fig"><span class="std std-numref">Fig. 7</span></a> from Poldrack, Mumford and Nichols (2011).</p>
<figure class="align-default" id="realign-poldrack-fig">
<a class="reference internal image-reference" href="_images/realign-poldrack.png"><img alt="_images/realign-poldrack.png" src="_images/realign-poldrack.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Illustration of motion correction.</span><a class="headerlink" href="#realign-poldrack-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>At its most basic, spatial motion correction is an image registration problem. We choose a single fMRI volume to act as our stationary reference image and then align all the other volumes to match. As such, you can think of it as a series of registration steps where the reference stays the same and the source is changed each time to be a subsequent fMRI volume. From this perspective, there is nothing particularly special about the mechanics of motion correction. The main focus of motion correction algorithms is speed , because we need to align 200+ images together and do not want to sit around for days waiting for the computer to finish. As such, most motion correction algorithms use least-squares as the cost function. In addition, motion correction only uses 6 parameters because scaling and shearing are not relevant for motion correction. Finally, SPM uses a very specific optimisation algorithm when estimating the transformation that can converge on a solution very quickly (as described in Friston et al. (2005)). Of note, however, is that this algorithm is more accurate for small movements and will not be able to correct very large motions accurately. So, we can think of motion correction as a highly tuned version of image registration, but with some caveats and limitations.</p>
<section id="motion-parameters">
<h3>Motion parameters<a class="headerlink" href="#motion-parameters" title="Permalink to this heading">#</a></h3>
<p>One of the main outputs from motion correction is the registration parameters for each volume. As we know, registration involves estimating a matrix T that is used to transform the source to match the target. For motion correction, there will be a T matrix estimated for each volume, that will contain the translations and rotations needed to match that volume to the reference. The parameters of these <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> matrices are useful because they tell us how much the subject moved over time. For instance, extracting and then plotting the <span class="math notranslate nohighlight">\(x\)</span>-translations from each <span class="math notranslate nohighlight">\(\mathbf{T}\)</span> matrix allows us to see how much the subject deviated from the target volume along the <span class="math notranslate nohighlight">\(x\)</span>-axis over time. An example of the form of motion parameter plot produced by motion correction is shown below.</p>
<figure class="align-default" id="mot-params-fig">
<a class="reference internal image-reference" href="_images/mot-params.png"><img alt="_images/mot-params.png" src="_images/mot-params.png" style="width: 650px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Example of the plots of motion parameters produced after motion correction.</span><a class="headerlink" href="#mot-params-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="resampling-the-fmri-data">
<h3>Resampling the fMRI data<a class="headerlink" href="#resampling-the-fmri-data" title="Permalink to this heading">#</a></h3>
<p>Once all the T matrices have been estimated it would be typical to turn these world-space transformations into voxel-space transformations, so that the timeseries at each voxel represents motion-corrected data. Resampling at this stage is particularly important for slice-timing correction, which is our next pre-processing step. This is because we need to make sure we do not have bits of the brain moving in and out of neighbouring slices across the course of the scan. In terms of the interpolation, higher-order B-spline methods are generally preferred, as evidence suggests that linear methods can introduce large errors (Ostuni et al., 1997). In principle we could just choose the highest-order available to us, but the gains in accuracy are likely going to be undone once we get to the final pre-processing step, which is spatial smoothing. SPM therefore defaults to a 4th-degree B-spline as a compromise.</p>
</section>
<section id="how-much-motion-it-too-much">
<h3>How much motion it too much?<a class="headerlink" href="#how-much-motion-it-too-much" title="Permalink to this heading">#</a></h3>
<p>Considering the fact that motion is inevitable, but also damaging, how much motion would we allow in our data before deciding the scan was too corrupted to use? This seems like an obvious question, but it is actually difficult to answer. As mentioned earlier, volume-to-volume motion is more damaging than steady and slow motion, because it is more difficult for traditional spatial motion correction to deal with. According to Poldrack, Mumford and Nichols (2011), a sudden translation spike of more than 1/2 a voxel size should be cause for concern. So if the voxels were 3mm isotropic then a spike of &gt; 1.5mm in the x, y or z planes may be a concern. This is similar for rotations, where you can calculate the angle for a distance of 1.5mm using</p>
<div class="math notranslate nohighlight">
\[
\theta = d\frac{180}{\pi r}
\]</div>
<p>where <span class="math notranslate nohighlight">\(d\)</span> is the distance and <span class="math notranslate nohighlight">\(r\)</span> is the radius of a circle. If we consider the head as a circle, then we can use a rough radius of 50mm (Power et al., 2012). This means for our 3mm isotropic voxels we have</p>
<div class="math notranslate nohighlight">
\[
1.72 = 1.5 \times \frac{180}{\pi \times 50}
\]</div>
<p>so that any sudden rotation greater than 1.72<span class="math notranslate nohighlight">\(^{\circ}\)</span> are also cause for concern. So what can be done about this? To some extent, it depends upon how corrupted an individual scan is. A couple of spikes may suggest the data is recoverable, whereas a scan that is littered with motion spikes will almost certainly be a lost cause. As an example, the plot below shows a couple of concerning spikes in the z-translation trace, but although these are large this would not be enough to suggest getting rid of the scan. However, if similar spikes were across the whole series of scans, we would begin to be concerned with the quality of the data and may need to consider not using this scan in our analysis.</p>
</section>
</section>
<section id="motion-correction-in-spm">
<h2>Motion correction in SPM<a class="headerlink" href="#motion-correction-in-spm" title="Permalink to this heading">#</a></h2>
<p>The video below will show you how to perform realignment using SPM12. The default in SPM is to perform a two-pass procedure where the images are aligned to the first volume, then a mean image is created from the realigned volumes and a second registration is performed to align these volumes with the mean. The final T matrices represent a combination of the transformations needed for both steps. The idea is that the registration can be more finely tuned using this second pass, although it realistically does not make a huge difference. Importantly, we will be saving this mean image to use in a later pre-processing step.</p>
<div style="max-width: 1280px"><div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"><iframe src="https://livemanchesterac.sharepoint.com/sites/UOM-FBMH-MSc-NCCN/_layouts/15/embed.aspx?UniqueId=27a69ee8-454c-4fe5-a640-e172328d949f&embed=%7B%22hvm%22%3Atrue%2C%22ust%22%3Atrue%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create" width="1280" height="720" frameborder="0" scrolling="no" allowfullscreen title="3.Motion-Correction.mov" style="border:none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; height: 100%; max-width: 100%;"></iframe></div></div></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "jupyter_matlab_kernel"
        },
        kernelOptions: {
            name: "jupyter_matlab_kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'jupyter_matlab_kernel'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="1.fmri-structure.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The Structure of fMRI Data</p>
      </div>
    </a>
    <a class="right-next"
       href="3.slice-timing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Step 2: Slice-Timing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems-with-motion">Problems with motion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corruption-of-the-timeseries">Corruption of the timeseries</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#corruption-of-the-measurement-of-the-signal">Corruption of the measurement of the signal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correlated-with-the-task">Motion correlated with the task</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction-theory">Motion correction theory</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-parameters">Motion parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resampling-the-fmri-data">Resampling the fMRI data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-much-motion-it-too-much">How much motion it too much?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-correction-in-spm">Motion correction in SPM</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>